会員管理システム Project Constitution（憲法） v2026-01
0) この憲法の効力

これは「設計思想」「守るべき原則」「禁止事項」を固定するための文書にゃあ。

ここに書いてあることは、実装都合より優先されるにゃあ（例外は“運用継続が不可能”な致命条件のみ）にゃあ。

追加するなら 思想/原則 だけ。日々の進捗は別の PROJECT_LOG.md に書くにゃあ。

1) 大前提（人と運用）

ユーザー（あなた）は コーディング/読解ができない。できるのは簡単なPC操作のみ。
→ だから「現場がコードを触らず回る」ことが最優先にゃあ。

AI（私）は、あなたの 設計思想を最優先し、それを実現する提案と手順を出すにゃあ。

管理者は Googleアカウントを持たない可能性がある。
→ 管理画面は Googleログイン前提にしない（パスワードログイン方式）にゃあ。

管理者は 2〜5人想定にゃあ。

2) 目的（何を達成したいか）

会員登録（新規・変更）を ノーコード運用で回すにゃあ。

Webフォーム → スプレッドシート保存 → メール認証 → 問い合わせ即応のログ体系、まで一気通貫にゃあ。

「メール認証済み＝必ず届く」 の思想は正として維持にゃあ（ここは絶対）にゃあ。

3) システム構成（揺らがない骨格）

データの起点は Googleスプレッドシート にゃあ。特に次が中核にゃあ：

config：フォーム設問の定義（表示/非表示、必須、型、選択肢、並び順）

設定：団体名、フォームタイトル、送信者、返信先、管理者メール1〜5、管理画面PW、URL有効期限、会員ID採番、承認制など

data：会員データ本体

admin_log：管理操作ログ

change_log：変更履歴（変更前→変更後が追える形が理想）

GAS は JSON API化してルーティングする（Api.gs の switch(route)）にゃあ。

Cloudflare Pages + Functions は APIリレー層にゃあ。

ブラウザは Cloudflareだけ叩くにゃあ。

GAS のURLや秘密（API_GATE_KEY等）を クライアントへ出さないにゃあ。

4) セキュリティ原則（守る順序）

秘密はクライアントに出さない（GAS URL / API_GATE_KEY）にゃあ。

API_GATE_KEY は Cloudflare の env から注入し、GAS は body.gateKey を検証にゃあ（header運用はしない）にゃあ。

管理者APIは adminToken（TTLあり） で認証にゃあ。

利用者APIは Turnstile を前提にし、GAS 側に cooldown（10分） を持たせるにゃあ。

列挙耐性を壊さないにゃあ：

request-edit は原則 常に success:true（存在/不在を漏らさない）にゃあ。

/api/* 未定義が HTML(200) に吸われるのは禁止にゃあ。未定義は JSON 404 にゃあ。

5) UX/仕様の原則（現場優先）

フォーム表示は config を起点に完全反映が原則にゃあ。

並び順は order列ではなく「configの行の上から順」 にゃあ。

行移動だけで並び替え可能、が理想にゃあ。

変更登録の確認画面は 見やすさ最優先にゃあ：

「項目名」「変更前」「変更後」を明示するにゃあ（問い合わせ対応が速くなる）にゃあ。

郵便番号→住所自動入力は 方針A：YubinBango採用にゃあ。

DOM生成タイミング由来の不安定は許容しないにゃあ。

住所ブロックは静的配置などで エラーゼロを目標にゃあ。

6) 設定・コンフィグ事故を防ぐ原則

設定 / config が“正”で、コードは必ずそれを読むにゃあ。

設定 とコードの参照キーがズレるとフォームが消える事故が起きるので、

「キー名の変更」「列構成の変更」は慎重にゃあ

変更するなら、検証手順（最低限のテスト）を必須化にゃあ。

7) 運用固定（テストと作法）

PowerShell の curl.exe は JSON直書き禁止にゃあ（環境でクォートが落ちて JSON が壊れる事故が起きた）にゃあ。

ファイル方式または ps1でJSON生成のみ許可にゃあ。

テストは tools/*.ps1 を正とし、手打ちコマンドを標準にしないにゃあ。

デバッグ用エンドポイントは増やしすぎないにゃあ（本番整理を維持）にゃあ。

8) 進め方ルール（会話運用）

一度に1ステップずつにゃあ。

ユーザーが「できた」「でぷった」と言うまで次に進まないにゃあ。

コード修正で全体提示が必要な場合は、該当ファイルの 全コード提示が前提にゃあ。

9) 将来の野望（v86 完全自動化：憲法としての宣言）

目標は「現場がコードを一切触らず運用できる」完全自動化にゃあ。

優先：

設定、config起点ノーコードを堅牢化（追加設問でも壊れない）にゃあ

行順＝表示順（行移動で入替）にゃあ

表示/必須/型/選択肢をconfigで完全制御にゃあ

YubinBangoを完全安定（DOMタイミング問題根絶）にゃあ
